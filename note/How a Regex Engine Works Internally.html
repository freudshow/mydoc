<!DOCTYPE html>
<!-- saved from url=(0048)https://www.regular-expressions.info/engine.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>How a Regex Engine Works Internally</title>
<link rel="alternate" media="only screen and (max-device-width: 979px)" href="https://regular-expressions.mobi/engine.html">
<script src="./How a Regex Engine Works Internally_files/f(4).txt"></script><script src="./How a Regex Engine Works Internally_files/ca-pub-7485249680256358.js"></script><script type="text/javascript">if (screen.width < 980) window.location.replace("//regular-expressions.mobi/engine.html?wlr=1");</script><script src="./How a Regex Engine Works Internally_files/regex.js" type="text/javascript"></script>
<link rel="alternate" type="application/rss+xml" title="Regex Guru" href="http://www.regexguru.com/feed/">
<meta name="Author" content="Jan Goyvaerts">
<meta name="Description" content="Understanding how a regex engine works internally enables you to craft better regular expressions by learning how to think like a regex engine.">
<meta name="Keywords" content="">
<link rel="StyleSheet" href="./How a Regex Engine Works Internally_files/regex.css" type="text/css">
<link rel="preload" href="./How a Regex Engine Works Internally_files/f(5).txt" as="script"><script type="text/javascript" src="./How a Regex Engine Works Internally_files/f(5).txt"></script></head>
<body bgcolor="white" text="black">
<script type="text/javascript">window.onresize = movecontent;</script>
<div id="top"></div>
<div id="btntop"><table align="center" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><a href="https://www.regular-expressions.info/quickstart.html" target="_top"><div onmouseover="this.style.backgroundColor=&#39;#FFA000&#39;;" onmouseout="this.style.backgroundColor=&#39;#A03300&#39;;return false;">Quick&nbsp;Start</div></a></td><td><a href="https://www.regular-expressions.info/tutorial.html" target="_top"><div onmouseover="this.style.backgroundColor=&#39;#FFA000&#39;;" onmouseout="this.style.backgroundColor=&#39;#A03300&#39;;return false;">Tutorial</div></a></td><td><a href="https://www.regular-expressions.info/tools.html" target="_top"><div onmouseover="this.style.backgroundColor=&#39;#FFA000&#39;;" onmouseout="this.style.backgroundColor=&#39;#A03300&#39;;return false;">Tools&nbsp;&amp;&nbsp;Languages</div></a></td><td><a href="https://www.regular-expressions.info/examples.html" target="_top"><div onmouseover="this.style.backgroundColor=&#39;#FFA000&#39;;" onmouseout="this.style.backgroundColor=&#39;#A03300&#39;;return false;">Examples</div></a></td><td><a href="https://www.regular-expressions.info/reference.html" target="_top"><div onmouseover="this.style.backgroundColor=&#39;#FFA000&#39;;" onmouseout="this.style.backgroundColor=&#39;#A03300&#39;;return false;">Reference</div></a></td><td><a href="https://www.regular-expressions.info/books.html" target="_top"><div onmouseover="this.style.backgroundColor=&#39;#FFA000&#39;;" onmouseout="this.style.backgroundColor=&#39;#A03300&#39;;return false;">Book&nbsp;Reviews</div></a></td></tr></tbody></table></div>
<div id="bodytext" style="left: 476px; width: 748px;">
<script type="text/javascript">movecontent();</script>
<div class="topad"><a href="https://www.regexbuddy.com/create.html" target="_top"><img src="./How a Regex Engine Works Internally_files/rxbtutorial100.png" srcset="ads/728/rxbtutorial100.png 1x, ads/728/rxbtutorial125.png 1.25x, ads/728/rxbtutorial150.png 1.5x, ads/728/rxbtutorial175.png 1.75x, ads/728/rxbtutorial200.png 2x, ads/728/rxbtutorial250.png 2.5x, ads/728/rxbtutorial300.png 3x, ads/728/rxbtutorial350.png 3.5x, ads/728/rxbtutorial400.png 4x" alt="RegexBuddyâ€”Better than a regular expression tutorial!"></a></div> <h1>First Look at How a Regex Engine Works Internally</h1> <p>Knowing how the regex engine works enables you to craft better regexes more easily. It helps you understand quickly why a particular regex does not do what you initially expected. This saves you lots of guesswork and head scratching when you need to write more complex regexes.</p> <p>After introducing a new regex token, this tutorial explains step by step how the regex engine actually processes that token. This inside look may seem a bit long-winded at certain times. But understanding how the regex engine works enables you to use its full power and help you avoid common mistakes.</p> <p>While there are many implementations of regular expressions that differ sometimes slightly and sometimes significantly in syntax and behavior, there are basically only two kinds of regular expression engines: text-directed engines, and regex-directed engines. Nearly all modern regex flavors are based on regex-directed engines. This is because certain very useful features, such as <a href="https://www.regular-expressions.info/repeat.html#lazy">lazy quantifiers</a> and <a href="https://www.regular-expressions.info/backref.html" target="_top">backreferences</a>, can only be implemented in regex-directed engines.</p> <p>A regex-directed engine walks through the regex, attempting to match the next token in the regex to the next character. If a match is found, the engine advances through the regex and the subject string. If a token fails to match, the engine <i>backtracks</i> to a previous position in the regex and the subject string where it can try a different path through the regex. This tutorial will talk a lot more about backtracking later on. Modern regex flavors using regex-directed engines have lots of features such as <a href="https://www.regular-expressions.info/atomic.html" target="_top">atomic grouping</a> and <a href="https://www.regular-expressions.info/possessive.html" target="_top">possessive quantifiers</a> that allow you to control this backtracking.</p> <p>A text-directed engine walks through the subject string, attempting all permutations of the regex before advancing to the next character in the string. A text-directed engine never backtracks. Thus, there isn't much to discuss about the matching process of a text-directed engine. In most cases, a text-directed engine finds the same matches as a regex-directed engine.</p> <p>When this tutorial talks about regex engine internals, the discussion assumes a regex-directed engine. It only mentions text-directed engines in situations where they find different matches. And that only really happens when your regex uses <a href="https://www.regular-expressions.info/alternation.html" target="_top">alternation</a> with two alternatives that can match at the same position.</p> <div class="adsense">
<script type="text/javascript"><!--
google_ad_client = "pub-7485249680256358";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "FF6600";
google_color_bg = "FFF4E8";
google_color_link = "EE5500";
google_color_text = "000000";
google_color_url = "803300";
google_ui_features = "rc:0";
//-->
</script>
<script type="text/javascript" src="./How a Regex Engine Works Internally_files/f(6).txt">
</script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./How a Regex Engine Works Internally_files/saved_resource(2).html"></iframe></ins></ins>
</div><h2>The Regex Engine Always Returns the Leftmost Match</h2> <p>This is a very important point to understand: a regex engine always returns the leftmost match, even if a "better" match could be found later. When applying a regex to a string, the engine starts at the first character of the string. It tries all possible permutations of the regular expression at the first character. Only if all possibilities have been tried and found to fail, does the engine continue with the second character in the text. Again, it tries all possible permutations of the regex, in exactly the same order. The result is that the regex engine returns the <i>leftmost</i> match.</p> <p>When applying <tt class="code"><span class="regexplain">cat</span></tt> to <tt class="string">He captured a catfish for his cat.</tt>, the engine tries to match the first token in the regex <tt class="code"><span class="regexplain">c</span></tt> to the first character in the match <tt class="string">H</tt>. This fails. There are no other possible permutations of this regex, because it merely consists of a sequence of literal characters. So the regex engine tries to match the <tt class="code"><span class="regexplain">c</span></tt> with the <tt class="string">e</tt>. This fails too, as does matching the <tt class="code"><span class="regexplain">c</span></tt> with the space. Arriving at the 4th character in the string, <tt class="code"><span class="regexplain">c</span></tt> matches <tt class="match">c</tt>. The engine then tries to match the second token <tt class="code"><span class="regexplain">a</span></tt> to the 5th character, <tt class="match">a</tt>. This succeeds too. But then, <tt class="code"><span class="regexplain">t</span></tt> fails to match <tt class="string">p</tt>. At that point, the engine knows the regex cannot be matched starting at the 4th character in the string. So it continues with the 5th: <tt class="string">a</tt>. Again, <tt class="code"><span class="regexplain">c</span></tt> fails to match here and the engine carries on. At the 15th character in the string, <tt class="code"><span class="regexplain">c</span></tt> again matches <tt class="match">c</tt>. The engine then proceeds to attempt to match the remainder of the regex at character 15 and finds that <tt class="code"><span class="regexplain">a</span></tt> matches <tt class="match">a</tt> and <tt class="code"><span class="regexplain">t</span></tt> matches <tt class="match">t</tt>.</p> <p>The entire regular expression could be matched starting at character 15. The engine is "eager" to report a match. It therefore reports the first three letters of catfish as a valid match. The engine never proceeds beyond this point to see if there are any "better" matches. The first match is considered good enough.</p> <p>In this first example of the engine's internals, our regex engine simply appears to work like a regular text search routine. However, it is important that you can follow the steps the engine takes in your mind. In following examples, the way the engine works has a profound impact on the matches it finds. Some of the results may be surprising. But they are always logical and predetermined, once you know how the engine works.</p><div class="adsense">
<script type="text/javascript"><!--
google_ad_client = "pub-7485249680256358";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "FF6600";
google_color_bg = "FFF4E8";
google_color_link = "EE5500";
google_color_text = "000000";
google_color_url = "803300";
google_ui_features = "rc:0";
//-->
</script>
<script type="text/javascript" src="./How a Regex Engine Works Internally_files/f(6).txt">
</script><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;width:728px;height:90px;" src="./How a Regex Engine Works Internally_files/saved_resource(3).html"></iframe></ins></ins>
</div> <h2>Make a Donation</h2> <p>Did this website just save you a trip to the bookstore? Please <a href="https://www.regular-expressions.info/donate.html">make a donation</a> to support this site, and you'll get a <b>lifetime of advertisement-free access</b> to this site!</p>  <div id="copyright"> <p class="copyright">Page URL: <a href="https://www.regular-expressions.info/engine.html" target="_top">https://www.regular-expressions.info/engine.html</a><br> Page last updated: 09 June 2017<br> Site last updated: 02 July 2018<br> Copyright Â© 2003-2018 Jan Goyvaerts. All rights reserved.</p> </div> </div> <div id="side" style="left: 191px;"><script type="text/javascript">movecontent();</script><table class="side" cellspacing="0" cellpadding="4"><tbody><tr><td class="sideheader">Regex Tutorial</td></tr><tr><td><a href="https://www.regular-expressions.info/tutorial.html" target="_top">Introduction</a></td></tr><tr><td><a href="https://www.regular-expressions.info/tutorialcnt.html" target="_top">Table&nbsp;of&nbsp;Contents</a></td></tr><tr><td><a href="https://www.regular-expressions.info/characters.html" target="_top">Special&nbsp;Characters</a></td></tr><tr><td><a href="https://www.regular-expressions.info/nonprint.html" target="_top">Non-Printable&nbsp;Characters</a></td></tr><tr><td><a href="https://www.regular-expressions.info/engine.html" target="_top">Regex&nbsp;Engine&nbsp;Internals</a></td></tr><tr><td><a href="https://www.regular-expressions.info/charclass.html" target="_top">Character&nbsp;Classes</a></td></tr><tr><td><a href="https://www.regular-expressions.info/charclasssubtract.html" target="_top">Character&nbsp;Class&nbsp;Subtraction</a></td></tr><tr><td><a href="https://www.regular-expressions.info/charclassintersect.html" target="_top">Character&nbsp;Class&nbsp;Intersection</a></td></tr><tr><td><a href="https://www.regular-expressions.info/shorthand.html" target="_top">Shorthand&nbsp;Character&nbsp;Classes</a></td></tr><tr><td><a href="https://www.regular-expressions.info/dot.html" target="_top">Dot</a></td></tr><tr><td><a href="https://www.regular-expressions.info/anchors.html" target="_top">Anchors</a></td></tr><tr><td><a href="https://www.regular-expressions.info/wordboundaries.html" target="_top">Word&nbsp;Boundaries</a></td></tr><tr><td><a href="https://www.regular-expressions.info/alternation.html" target="_top">Alternation</a></td></tr><tr><td><a href="https://www.regular-expressions.info/optional.html" target="_top">Optional&nbsp;Items</a></td></tr><tr><td><a href="https://www.regular-expressions.info/repeat.html" target="_top">Repetition</a></td></tr><tr><td><a href="https://www.regular-expressions.info/brackets.html" target="_top">Grouping&nbsp;&amp;&nbsp;Capturing</a></td></tr><tr><td><a href="https://www.regular-expressions.info/backref.html" target="_top">Backreferences</a></td></tr><tr><td><a href="https://www.regular-expressions.info/backref2.html" target="_top">Backreferences,&nbsp;part&nbsp;2</a></td></tr><tr><td><a href="https://www.regular-expressions.info/named.html" target="_top">Named&nbsp;Groups</a></td></tr><tr><td><a href="https://www.regular-expressions.info/backrefrel.html" target="_top">Relative&nbsp;Backreferences</a></td></tr><tr><td><a href="https://www.regular-expressions.info/branchreset.html" target="_top">Branch&nbsp;Reset&nbsp;Groups</a></td></tr><tr><td><a href="https://www.regular-expressions.info/freespacing.html" target="_top">Free-Spacing&nbsp;&amp;&nbsp;Comments</a></td></tr><tr><td><a href="https://www.regular-expressions.info/unicode.html" target="_top">Unicode</a></td></tr><tr><td><a href="https://www.regular-expressions.info/modifiers.html" target="_top">Mode&nbsp;Modifiers</a></td></tr><tr><td><a href="https://www.regular-expressions.info/atomic.html" target="_top">Atomic&nbsp;Grouping</a></td></tr><tr><td><a href="https://www.regular-expressions.info/possessive.html" target="_top">Possessive&nbsp;Quantifiers</a></td></tr><tr><td><a href="https://www.regular-expressions.info/lookaround.html" target="_top">Lookahead&nbsp;&amp;&nbsp;Lookbehind</a></td></tr><tr><td><a href="https://www.regular-expressions.info/lookaround2.html" target="_top">Lookaround,&nbsp;part&nbsp;2</a></td></tr><tr><td><a href="https://www.regular-expressions.info/keep.html" target="_top">Keep&nbsp;Text&nbsp;out&nbsp;of&nbsp;The&nbsp;Match</a></td></tr><tr><td><a href="https://www.regular-expressions.info/conditional.html" target="_top">Conditionals</a></td></tr><tr><td><a href="https://www.regular-expressions.info/balancing.html" target="_top">Balancing&nbsp;Groups</a></td></tr><tr><td><a href="https://www.regular-expressions.info/recurse.html" target="_top">Recursion</a></td></tr><tr><td><a href="https://www.regular-expressions.info/subroutine.html" target="_top">Subroutines</a></td></tr><tr><td><a href="https://www.regular-expressions.info/recurseinfinite.html" target="_top">Infinite&nbsp;Recursion</a></td></tr><tr><td><a href="https://www.regular-expressions.info/recurserepeat.html" target="_top">Recursion&nbsp;&amp;&nbsp;Quantifiers</a></td></tr><tr><td><a href="https://www.regular-expressions.info/recursecapture.html" target="_top">Recursion&nbsp;&amp;&nbsp;Capturing</a></td></tr><tr><td><a href="https://www.regular-expressions.info/recursebackref.html" target="_top">Recursion&nbsp;&amp;&nbsp;Backreferences</a></td></tr><tr><td><a href="https://www.regular-expressions.info/recursebacktrack.html" target="_top">Recursion&nbsp;&amp;&nbsp;Backtracking</a></td></tr><tr><td><a href="https://www.regular-expressions.info/posixbrackets.html" target="_top">POSIX&nbsp;Bracket&nbsp;Expressions</a></td></tr><tr><td><a href="https://www.regular-expressions.info/zerolength.html" target="_top">Zero-Length&nbsp;Matches</a></td></tr><tr><td><a href="https://www.regular-expressions.info/continue.html" target="_top">Continuing&nbsp;Matches</a></td></tr>
</tbody></table><table class="side" cellspacing="0" cellpadding="4"><tbody><tr><td class="sideheader">More on This Site</td></tr><tr><td><a href="https://www.regular-expressions.info/index.html" target="_top">Introduction</a></td></tr><tr><td><a href="https://www.regular-expressions.info/quickstart.html" target="_top">Regular&nbsp;Expressions&nbsp;Quick&nbsp;Start</a></td></tr><tr><td><a href="https://www.regular-expressions.info/tutorial.html" target="_top">Regular&nbsp;Expressions&nbsp;Tutorial</a></td></tr><tr><td><a href="https://www.regular-expressions.info/replacetutorial.html" target="_top">Replacement&nbsp;Strings&nbsp;Tutorial</a></td></tr><tr><td><a href="https://www.regular-expressions.info/tools.html" target="_top">Applications&nbsp;and&nbsp;Languages</a></td></tr><tr><td><a href="https://www.regular-expressions.info/examples.html" target="_top">Regular&nbsp;Expressions&nbsp;Examples</a></td></tr><tr><td><a href="https://www.regular-expressions.info/reference.html" target="_top">Regular&nbsp;Expressions&nbsp;Reference</a></td></tr><tr><td><a href="https://www.regular-expressions.info/refreplace.html" target="_top">Replacement&nbsp;Strings&nbsp;Reference</a></td></tr><tr><td><a href="https://www.regular-expressions.info/books.html" target="_top">Book&nbsp;Reviews</a></td></tr><tr><td><a href="https://www.regular-expressions.info/print.html" target="_top">Printable&nbsp;PDF</a></td></tr><tr><td><a href="https://www.regular-expressions.info/about.html" target="_top">About&nbsp;This&nbsp;Site</a></td></tr><tr><td><a href="https://www.regular-expressions.info/updates.html" target="_top">RSS&nbsp;Feed&nbsp;&amp;&nbsp;Blog</a></td></tr></tbody></table></div><script type="text/javascript">movecontent();</script><iframe id="google_osd_static_frame_8352979287233" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;" src="./How a Regex Engine Works Internally_files/saved_resource(4).html"></iframe></body></html>